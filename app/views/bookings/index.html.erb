<div class="container d-flex pt-3">
  <div class="container col-6">
    <h1>Booking Requests</h1>

    <% if @provider_bookings.present? %>
    <% @provider_bookings.each do |provider_booking| %>
    <div class="card mb-3 shadow-sm" style="max-width: 100%;">
    <div class="d-flex justify-content-between p-3">
    <div>
      <div class="d-flex align-items-center">
        <%= image_tag "https://kitt.lewagon.com/placeholder/users/ssaunier", class: "avatar dropdown-toggle", id: "navbarDropdown", data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
        <h4 class="ms-2"><%= provider_booking.user.email %></h4>
      </div>
    <div class="d-flex">
      <p class="mb-0">wants to rent </p><h5 class="ms-3"><strong><%= provider_booking.vehicle.title %></strong></h5></div>
      <p>From:
      <%= provider_booking.start_date %> To: <%= provider_booking.end_date %></p>
    </div>
  <div>
    <% if provider_booking.pending? %>
      <%= simple_form_for provider_booking do |f| %>
      <%= f.input :status, as: :hidden, input_html: { value: "approved" } %>
      <%= f.submit 'Accept', class: 'btn btn-info' %>
    <% end %>
      <%= simple_form_for provider_booking do |f| %>
      <%= f.input :status, as: :hidden, input_html: { value: "declined" } %>
      <%= f.submit 'Reject', class: 'btn btn-light' %>
    <% end %>
  <% else %>
  <% case provider_booking.status %>
      <% when "pending" %>
      <% badge_color = "bg-warning" %>
      <% when "approved" %>
      <% badge_color = "bg-success" %>
      <% when "declined" %>
      <% badge_color = "bg-danger" %>
      <% when "cancelled" %>
      <% badge_color = "bg-secondary" %>
      <% end %>
    <p class="badge text-white <%= badge_color %> text-shadow mt-2 ms-2 p-2" style="border-radius: 50px; width: 100px; z-index: 1;"><%= provider_booking.status %></p>
    <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <p>No bookings found.</p>
      <% end %>
    </div>

<div class="container col-6">
<h1>My Bookings</h1>

<% if @my_bookings.present? %>
  <% @my_bookings.each do |booking| %>
    <div class="card mb-3 shadow-sm" style="max-width: 100%;">
    <div class="row g-0">

  <div class="col-md-4 temporary-vehicle position-relative" style="background: url(<%= asset_path 'default_caravan.png' %>); background-size: contain; background-position: center; background-repeat: no-repeat; background-color: white;">
  <% case booking.status %>
      <% when "pending" %>
      <% badge_color = "bg-warning" %>
      <% when "approved" %>
      <% badge_color = "bg-success" %>
      <% when "declined" %>
      <% badge_color = "bg-danger" %>
      <% when "cancelled" %>
      <% badge_color = "bg-secondary" %>
      <% end %>

   <p class="badge text-white <%= badge_color %> text-shadow position-absolute mt-2 ms-2 p-2" style="border-radius: 50px; width: 100px; z-index: 1;"><%= booking.status %></p>
      </div>

        <div class="col-md-8 px-3">
          <div class="card-body">

  <% rental_duration = (booking.end_date.to_time - booking.start_date.to_time).to_i / 1.day.seconds + 1 %>

            <div class="d-flex justify-content-between col-12">
            <h4 class="card-title text-capitalize"><%= booking.vehicle.title %></h4>
            <h5>¥<%= format_price(booking.vehicle.price * rental_duration) %></h5>
            </div>
            <div>
            <div class="d-flex"><p class="card-text text-primary col-4">Rental: </p><p class="col-4"><%= booking.start_date %></p></div>
            <div class="d-flex"><p class="card-text text-primary col-4">Return: </p><p class="col-4"><%= booking.end_date %></p></div>
            <div class="d-flex justify-content-end"><p class="card-text">(<%= rental_duration %> days)</p></div>
            </div>

            <p class="card-text">Provider: <%=  booking.vehicle.user.email %></p>
            <div class="d-flex justify-content-between"><p class="card-text">Daily Rate: </p><p>¥<%= format_price(booking.vehicle.price) %></p></div>

          </div>
        </div>
      </div>
    </div>
  <% end %>
<% else %>
  <p>No bookings found.</p>
<% end %>
</div>
</div>
